# ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Subcategories ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úÖ

## ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß

### 1. ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏•‡∏ö `group_key` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á `subcategories` (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ subcategory ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° SKU ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏≤‡∏° part group)
- ‡∏•‡∏ö `image_url` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å `subcategories` (‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á assets ‡πÅ‡∏ó‡∏ô)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `subcategory_id` (uuid) ‡πÉ‡∏ô `assets` table ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö `subcategories`
- ‡∏™‡∏£‡πâ‡∏≤‡∏á index ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

### 2. ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á SKUs ‡πÉ‡∏´‡∏°‡πà
‡∏°‡∏µ SKU ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 6 ‡∏ï‡∏±‡∏ß:
- `daytona` - Daytona
- `submarine` - Submarine  
- `SKU2` - ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ SKU2
- `SKU3` - ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ SKU3
- `SKU4` - ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ SKU4
- `SKU5` - ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ SKU5

### 3. ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Subcategories
‡πÅ‡∏ï‡πà‡∏•‡∏∞ SKU ‡∏°‡∏µ subcategories ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

**SKU2:**
- ‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (ID: `ead859e6-cde8-4c39-a037-29d0d59cd04e`)
- ‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (ID: `cac7c194-7d72-4599-ba7c-3f6ed2cc6cdc`)

**SKU3:**
- ‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (ID: `63b38154-6ea7-4531-84d4-b1cf5857973b`)
- ‡∏£‡∏∏‡πà‡∏ô‡∏•‡∏¥‡∏°‡∏¥‡πÄ‡∏ï‡πá‡∏î (ID: `20d7913a-f441-4b38-9178-fe5bceb931ec`)

**SKU4:**
- ‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (ID: `efbc7dcf-bc13-424c-a7a7-51af53a4aa15`)
- ‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥ (ID: `e733df46-a775-4cfe-9956-079a287012b3`)

**SKU5:**
- ‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (ID: `f0350efb-21a1-4102-80e3-54e942a21301`)
- ‡∏£‡∏∏‡πà‡∏ô‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï (ID: `4cd5c066-82ef-4e7e-b53a-0439cffa023d`)

**Daytona & Submarine:**
- ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô

### 4. ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á View ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‡∏™‡∏£‡πâ‡∏≤‡∏á `assets_with_subcategory` view ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
- SKU details (id, name)
- Subcategory details (id, name, sort_order)
- Part group details (key, name_th, name_en, z_index)
- Asset details (label, url, sort)

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

```sql
-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á skus
skus (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ
)

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á subcategories
subcategories (
  id UUID PRIMARY KEY,
  sku_id TEXT REFERENCES skus(id),  -- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö SKU
  name TEXT NOT NULL,                -- ‡∏ä‡∏∑‡πà‡∏≠ subcategory
  sort_order INT,                    -- ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  created_at TIMESTAMPTZ
)

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á assets
assets (
  id UUID PRIMARY KEY,
  sku_id TEXT REFERENCES skus(id),
  subcategory_id UUID REFERENCES subcategories(id),  -- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö subcategory
  subcategory TEXT,                                  -- ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ backward compatibility
  group_key TEXT REFERENCES part_groups(key),
  label TEXT,
  url TEXT NOT NULL,
  sort INT,
  created_at TIMESTAMPTZ
)
```

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 1. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Subcategories ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```sql
SELECT 
  s.id as sku_id,
  s.name as sku_name,
  sc.id as subcategory_id,
  sc.name as subcategory_name,
  sc.sort_order
FROM skus s
LEFT JOIN subcategories sc ON sc.sku_id = s.id
ORDER BY s.name, sc.sort_order;
```

### 2. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Subcategories ‡∏Ç‡∏≠‡∏á SKU ‡πÄ‡∏â‡∏û‡∏≤‡∏∞

```sql
-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏î‡∏π subcategories ‡∏Ç‡∏≠‡∏á SKU2
SELECT id, name, sort_order
FROM subcategories
WHERE sku_id = 'SKU2'
ORDER BY sort_order;
```

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤ Subcategory

```sql
-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å subcategory_id
SELECT id FROM subcategories WHERE sku_id = 'SKU2' AND name = '‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô';

-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ (‡πÉ‡∏ä‡πâ id ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô)
INSERT INTO assets (sku_id, subcategory_id, group_key, label, url, sort)
VALUES (
  'SKU2',
  'ead859e6-cde8-4c39-a037-29d0d59cd04e',  -- subcategory_id
  'dial',
  '‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏î 1',
  'https://your-storage-url/SKU2/dial1.png',
  1
);
```

### 4. ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏° Subcategory

```sql
-- ‡πÉ‡∏ä‡πâ View ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
SELECT * FROM assets_with_subcategory
WHERE sku_id = 'SKU2' AND subcategory_name = '‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô'
ORDER BY z_index, sort;
```

### 5. ‡∏¢‡πâ‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà Subcategory

```sql
-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏¢‡πâ‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á daytona ‡πÑ‡∏õ‡∏ó‡∏µ‡πà subcategory "‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô"
UPDATE assets
SET subcategory_id = '4d35def8-6a6d-458e-84b9-584371dad1ee'
WHERE sku_id = 'daytona' AND subcategory_id IS NULL;
```

### 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á Subcategory ‡πÉ‡∏´‡∏°‡πà

```sql
INSERT INTO subcategories (sku_id, name, sort_order)
VALUES ('SKU2', '‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏µ‡∏¨‡∏≤', 3);
```

### 7. ‡∏•‡∏ö Subcategory

```sql
-- ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢ (cascade)
DELETE FROM subcategories WHERE id = 'YOUR-UUID-HERE';
```

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Frontend

### ‡πÉ‡∏ô admin.html - ‡πÅ‡∏™‡∏î‡∏á Dropdown Subcategories

```javascript
// ‡∏î‡∏∂‡∏á subcategories ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å SKU
async function loadSubcategoriesForSKU(skuId) {
  const { data, error } = await supabase
    .from('subcategories')
    .select('id, name, sort_order')
    .eq('sku_id', skuId)
    .order('sort_order');
  
  if (error) {
    console.error('Error loading subcategories:', error);
    return [];
  }
  
  return data;
}

// ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô dropdown
function renderSubcategoryDropdown(subcategories) {
  const html = subcategories.map(sc => 
    `<option value="${sc.id}">${sc.name}</option>`
  ).join('');
  
  document.getElementById('subcategory-select').innerHTML = html;
}
```

### ‡πÉ‡∏ô script.js - ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏° Subcategory

```javascript
// ‡πÇ‡∏´‡∏•‡∏î assets ‡∏û‡∏£‡πâ‡∏≠‡∏° subcategory
async function loadAssetsWithSubcategory(skuId, subcategoryId = null) {
  let query = supabase
    .from('assets_with_subcategory')
    .select('*')
    .eq('sku_id', skuId);
  
  if (subcategoryId) {
    query = query.eq('subcategory_id', subcategoryId);
  }
  
  const { data, error } = await query.order('z_index').order('sort');
  
  if (error) {
    console.error('Error loading assets:', error);
    return [];
  }
  
  return data;
}
```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå

‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÉ‡∏ô `2/SKU2/`, `2/SKU3/` ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î:

1. **‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase Storage:**
   - Path: `watch-assets/SKU2/{group_key}/{filename}.png`
   - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: `watch-assets/SKU2/dial/6710f48460cce0e9a7cc242d.png`

2. **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡∏•‡∏á database:**
   ```sql
   INSERT INTO assets (sku_id, subcategory_id, group_key, label, url, sort)
   VALUES (
     'SKU2',
     'ead859e6-cde8-4c39-a037-29d0d59cd04e',
     'dial',
     '‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏î 1',
     'https://orqyxamgukajopqdxpdg.supabase.co/storage/v1/object/public/watch-assets/SKU2/dial/6710f48460cce0e9a7cc242d.png',
     1
   );
   ```

## Query ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå

### ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ï‡πà‡∏•‡∏∞ SKU/Subcategory

```sql
SELECT 
  s.name as sku_name,
  sc.name as subcategory_name,
  a.group_key,
  COUNT(*) as image_count
FROM assets a
LEFT JOIN skus s ON a.sku_id = s.id
LEFT JOIN subcategories sc ON a.subcategory_id = sc.id
GROUP BY s.name, sc.name, a.group_key
ORDER BY s.name, sc.name, a.group_key;
```

### ‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Subcategory

```sql
SELECT sku_id, group_key, COUNT(*) as count
FROM assets
WHERE subcategory_id IS NULL
GROUP BY sku_id, group_key
ORDER BY sku_id, group_key;
```

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Subcategory ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ

```sql
SELECT 
  s.name as sku_name,
  sc.name as subcategory_name,
  COUNT(a.id) as image_count
FROM subcategories sc
JOIN skus s ON sc.sku_id = s.id
LEFT JOIN assets a ON a.subcategory_id = sc.id
GROUP BY s.name, sc.name
HAVING COUNT(a.id) = 0;
```

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ

1. ‚úÖ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
2. üî≤ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï `admin.html` ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á subcategory dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å SKU
3. üî≤ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `script.js` ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ï‡∏≤‡∏° subcategory
4. üî≤ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `2/SKU2/`, `2/SKU3/`, ‡∏Ø‡∏•‡∏Ø
5. üî≤ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å `subcategory_id` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏π‡∏õ

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á UI Flow

1. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å SKU** ‚Üí ‡πÅ‡∏™‡∏î‡∏á dropdown subcategories
2. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Subcategory** ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á subcategory ‡∏ô‡∏±‡πâ‡∏ô
3. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô** ‚Üí ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á subcategory ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
4. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Save/Download** ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î browser console ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π error logs ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö

