<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Configurator - Local</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' rx='3' ry='3' fill='%230e141b'/%3E%3Cpath d='M4 8h8M8 4v8' stroke='%23e7edf3' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0069d9;
        }
        .code {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            font-family: monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        .steps {
            margin: 20px 0;
        }
        .step {
            margin-bottom: 15px;
            padding-left: 30px;
            position: relative;
        }
        .step:before {
            content: counter(step-counter);
            counter-increment: step-counter;
            position: absolute;
            left: 0;
            top: 0;
            background-color: #007bff;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .steps {
            counter-reset: step-counter;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Watch Configurator - Local Setup</h1>
        
        <div id="connection-status" class="status warning">
            กำลังตรวจสอบการเชื่อมต่อกับ Supabase...
        </div>
        
        <div class="steps">
            <h2>ขั้นตอนการเชื่อมต่อฐานข้อมูล Supabase:</h2>
            
            <div class="step">
                <strong>ตรวจสอบการเชื่อมต่อ Supabase</strong>
                <p>กดปุ่มด้านล่างเพื่อตรวจสอบว่าสามารถเชื่อมต่อกับ Supabase ได้หรือไม่</p>
                <button onclick="checkSupabaseConnection()">ตรวจสอบการเชื่อมต่อ</button>
            </div>
            
            <div class="step">
                <strong>สร้าง Storage Bucket</strong>
                <p>ถ้ายังไม่มี Storage bucket ชื่อ 'watch-assets' ให้สร้างโดยใช้คำสั่ง SQL ด้านล่างใน Supabase SQL Editor:</p>
                <div class="code">
                    select storage.create_bucket('watch-assets', public => true);
                </div>
            </div>
            
            <div class="step">
                <strong>เพิ่มข้อมูลตัวอย่าง</strong>
                <p>เพิ่มข้อมูลตัวอย่างในตาราง skus และ assets โดยใช้คำสั่ง SQL ด้านล่าง:</p>
                <div class="code">
-- เพิ่มข้อมูล SKU
insert into public.skus (id,name) values ('default','Default Watch') on conflict (id) do update set name=excluded.name;

-- เพิ่มข้อมูล Assets (แก้ไข URL ให้ตรงกับที่อยู่ของคุณ)
insert into public.assets (sku_id, group_key, label, url, sort) values
('default','dial','Dial 1','./assets/dial1.png',1),
('default','dial','Dial 2','./assets/dial2.png',2),
('default','hands','Hands 1','./assets/hands1.png',1),
('default','hands','Hands 2','./assets/hands2.png',2),
('default','second','Second 1','./assets/second1.png',1),
('default','second','Second 2','./assets/second2.png',2),
('default','outer','Outer 1','./assets/outer1.png',1),
('default','outer','Outer 2','./assets/outer2.png',2),
('default','inner','Inner 1','./assets/inner1.png',1),
('default','inner','Inner 2','./assets/inner2.png',2),
('default','bracelet','Bracelet 1','./assets/bracelet1.png',1),
('default','bracelet','Bracelet 2','./assets/bracelet2.png',2)
on conflict do nothing;
                </div>
            </div>
            
            <div class="step">
                <strong>เปิด Watch Configurator</strong>
                <p>หลังจากตั้งค่าฐานข้อมูลเรียบร้อยแล้ว ให้กดปุ่มด้านล่างเพื่อเปิดแอปพลิเคชัน:</p>
                <button onclick="openApp()">เปิด Watch Configurator</button>
            </div>
        </div>
        
        <div id="help-section">
            <h2>คำแนะนำเพิ่มเติม:</h2>
            <ul>
                <li>ถ้าต้องการใช้ข้อมูลในเครื่อง (localStorage) แทน Supabase ให้ลบหรือเปลี่ยนชื่อไฟล์ supabase.config.js</li>
                <li>สามารถเพิ่มข้อมูล SKU และ Assets ผ่านหน้า Admin ในแอปพลิเคชันได้</li>
                <li>รูปภาพควรอยู่ในโฟลเดอร์ assets หรืออัปโหลดไปยัง Supabase Storage</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ฝังข้อมูลการเชื่อมต่อ Supabase ไว้ในไฟล์ HTML โดยตรงเพื่อแก้ปัญหา CORS
        window.SUPABASE_URL = 'https://orqyxamgukajopqdxpdg.supabase.co';
        window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ycXl4YW1ndWtham9wcWR4cGRnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTk5MjksImV4cCI6MjA3NjU3NTkyOX0.f3S0gkVToR24Ceexjo73Yhzl2awaJAzjY_s7Balj26g';
    </script>
    <script>
        async function checkSupabaseConnection() {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.textContent = 'กำลังตรวจสอบการเชื่อมต่อ...';
            statusDiv.className = 'status warning';
            
            try {
                const hasKeys = !!(window.SUPABASE_URL && window.SUPABASE_ANON_KEY);
                const hasSDK = !!(window.supabase && window.supabase.createClient);
                
                if (!hasKeys) {
                    statusDiv.textContent = 'ไม่พบข้อมูลการเชื่อมต่อ Supabase ใน supabase.config.js';
                    statusDiv.className = 'status error';
                    return;
                }
                
                if (!hasSDK) {
                    statusDiv.textContent = 'ไม่สามารถโหลด Supabase SDK ได้';
                    statusDiv.className = 'status error';
                    return;
                }
                
                const client = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
                const { data, error } = await client.from('skus').select('id,name').limit(1);
                
                if (error) {
                    statusDiv.textContent = `เกิดข้อผิดพลาดในการเชื่อมต่อ: ${error.message}`;
                    statusDiv.className = 'status error';
                } else {
                    statusDiv.textContent = 'เชื่อมต่อกับ Supabase สำเร็จ!';
                    statusDiv.className = 'status success';
                }
            } catch (err) {
                statusDiv.textContent = `เกิดข้อผิดพลาด: ${err.message}`;
                statusDiv.className = 'status error';
            }
        }
        
        function openApp() {
            window.open('./index.html', '_blank');
        }
        
        // ตรวจสอบการเชื่อมต่อโดยอัตโนมัติเมื่อโหลดหน้า
        window.addEventListener('DOMContentLoaded', checkSupabaseConnection);
    </script>
</body>
</html>
